# Parent Dashboard & Learning Analytics - Design Specification

## 1. ç›®æ ‡ç”¨æˆ·ä¸æ ¸å¿ƒéœ€æ±‚

### ç›®æ ‡ç”¨æˆ·

- **å®¶é•¿**: æƒ³äº†è§£å­©å­å­¦ä¹ è¿›åº¦ï¼Œä¸éœ€è¦æ‡‚æ•°å­¦
- **å­¦ç”Ÿè‡ªå·±**: æƒ³çœ‹åˆ°è‡ªå·±çš„æˆé•¿ï¼Œè·å¾—æˆå°±æ„Ÿ

### æ ¸å¿ƒé—®é¢˜ (å®¶é•¿è§†è§’)

1. å­©å­æœ€è¿‘æœ‰åœ¨å­¦ä¹ å—ï¼Ÿ(å‚ä¸åº¦)
2. å­©å­å­¦å¾—æ€ä¹ˆæ ·ï¼Ÿ(æ•ˆæœ)
3. å­©å­å“ªé‡Œè–„å¼±ï¼Ÿ(è¯Šæ–­)
4. å­©å­æœ‰è¿›æ­¥å—ï¼Ÿ(è¶‹åŠ¿)

---

## 2. æŒ‡æ ‡ä½“ç³»è®¾è®¡

### 2.1 ä¸€çº§æŒ‡æ ‡ (Dashboard é¡¶éƒ¨å¡ç‰‡)

| æŒ‡æ ‡           | è®¡ç®—æ–¹å¼                                 | æ„ä¹‰     | é¢œè‰²   |
| -------------- | ---------------------------------------- | -------- | ------ |
| **å­¦ä¹ å¤©æ•°**   | COUNT(DISTINCT DATE(started_at))         | å‚ä¸åº¦   | Blue   |
| **ç‹¬ç«‹å®Œæˆç‡** | completed / (completed + revealed) Ã— 100 | å­¦ä¹ æ•ˆæœ | Green  |
| **æœ¬å‘¨ç»ƒä¹ **   | COUNT(sessions WHERE started_at > 7å¤©å‰) | è¿‘æœŸæ´»è·ƒ | Purple |
| **è¿ç»­å­¦ä¹ **   | è®¡ç®—è¿ç»­å¤©æ•°streak                       | ä¹ æƒ¯å…»æˆ | Amber  |

### 2.2 äºŒçº§æŒ‡æ ‡ (è¯¦æƒ…åŒºåŸŸ)

| æŒ‡æ ‡         | è®¡ç®—æ–¹å¼              | æ„ä¹‰         |
| ------------ | --------------------- | ------------ |
| å¹³å‡å›°æƒ‘æ¬¡æ•° | AVG(confusion_count)  | ç†è§£éš¾åº¦     |
| å¹³å‡åˆ°è¾¾å±‚çº§ | AVG(layer_number)     | éœ€è¦å¤šå°‘æç¤º |
| é¢˜å‹åˆ†å¸ƒ     | GROUP BY problem_type | ç»ƒä¹ å¹¿åº¦     |
| é¢˜å‹å®Œæˆç‡   | æ¯ç§é¢˜å‹çš„ç‹¬ç«‹å®Œæˆç‡  | æ“…é•¿/è–„å¼±    |

### 2.3 è¶‹åŠ¿æŒ‡æ ‡ (æœªæ¥å¯æ‰©å±•)

| æŒ‡æ ‡         | æ„ä¹‰       |
| ------------ | ---------- |
| å‘¨å®Œæˆç‡è¶‹åŠ¿ | æ˜¯å¦åœ¨è¿›æ­¥ |
| æ¯æ—¥ç»ƒä¹ é‡   | å­¦ä¹ èŠ‚å¥   |
| å›°æƒ‘æ¬¡æ•°å˜åŒ– | ç†è§£åŠ›æå‡ |

---

## 3. æ•°æ®æ¨¡å‹

### 3.1 æ–°å¢ API Endpoints

```
GET /api/v1/stats/dashboard
Response: {
  // æ ¸å¿ƒå¡ç‰‡
  total_learning_days: number,
  independent_completion_rate: number,  // 0-100
  sessions_this_week: number,
  learning_streak: number,

  // è¯¦ç»†ç»Ÿè®¡
  avg_confusion_count: number,
  avg_layers_to_complete: number,

  // é¢˜å‹åˆ†æ
  problem_type_stats: [
    {
      type: "linear_equation_1var",
      label: "ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹",
      total: number,
      completed: number,
      revealed: number,
      completion_rate: number
    }
  ],

  // æœ€è¿‘æ´»åŠ¨
  recent_sessions: SessionListItem[],  // æœ€è¿‘5æ¡

  // å…ƒæ•°æ®
  first_session_date: string | null,
  last_session_date: string | null
}
```

### 3.2 æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

éœ€è¦çš„èšåˆæŸ¥è¯¢:

```sql
-- å­¦ä¹ å¤©æ•°
SELECT COUNT(DISTINCT DATE(started_at)) FROM hint_sessions;

-- è¿ç»­å­¦ä¹ å¤©æ•° (éœ€è¦é€’å½’CTEæˆ–åº”ç”¨å±‚è®¡ç®—)
-- æŒ‰æ—¥æœŸåˆ†ç»„ï¼Œæ‰¾æœ€é•¿è¿ç»­åºåˆ—

-- é¢˜å‹ç»Ÿè®¡
SELECT
  p.problem_type,
  COUNT(*) as total,
  SUM(CASE WHEN s.status = 'completed' THEN 1 ELSE 0 END) as completed,
  SUM(CASE WHEN s.status = 'revealed' THEN 1 ELSE 0 END) as revealed
FROM hint_sessions s
JOIN problems p ON s.problem_id = p.id
GROUP BY p.problem_type;
```

---

## 4. UI è®¾è®¡

### 4.1 å¸ƒå±€ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  StepWise                          [è¿”å›åšé¢˜]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ‘‹ æ¬¢è¿å›æ¥ï¼                                       â”‚
â”‚  å·²ç»è¿ç»­å­¦ä¹  3 å¤©äº†ï¼Œç»§ç»­ä¿æŒï¼                      â”‚
â”‚                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… å­¦ä¹ å¤©æ•°  â”‚  âœ… ç‹¬ç«‹å®Œæˆ  â”‚  ğŸ“Š æœ¬å‘¨ç»ƒä¹   â”‚ ğŸ”¥ è¿ç»­ â”‚
â”‚     12å¤©     â”‚    75%      â”‚     8é¢˜      â”‚  3å¤©   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ“ˆ é¢˜å‹æŒæ¡æƒ…å†µ                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  85%  (17/20)  â”‚   â”‚
â”‚  â”‚ äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  50%  (3/6)    â”‚   â”‚
â”‚  â”‚ ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  33%  (1/3)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  ğŸ“œ æœ€è¿‘ç»ƒä¹                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3x + 5 = 14          å·²å®Œæˆ    2å°æ—¶å‰      â”‚   â”‚
â”‚  â”‚ xÂ² - 4 = 0           æŸ¥çœ‹è§£ç­”   æ˜¨å¤©        â”‚   â”‚
â”‚  â”‚ ...                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ç»„ä»¶æ‹†åˆ†

```
Dashboard/
â”œâ”€â”€ DashboardHeader.tsx      # æ¬¢è¿è¯­ + é¼“åŠ±ä¿¡æ¯
â”œâ”€â”€ StatsCardGrid.tsx        # 4ä¸ªæ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡
â”œâ”€â”€ ProblemTypeProgress.tsx  # é¢˜å‹è¿›åº¦æ¡
â”œâ”€â”€ RecentSessions.tsx       # æœ€è¿‘ç»ƒä¹ åˆ—è¡¨ (å¤ç”¨ SessionHistoryList)
â””â”€â”€ Dashboard.tsx            # ä¸»å®¹å™¨
```

### 4.3 é¼“åŠ±æ€§æ–‡æ¡ˆè§„åˆ™

| æ¡ä»¶                  | æ–‡æ¡ˆ                                |
| --------------------- | ----------------------------------- |
| streak >= 7           | "å¤ªæ£’äº†ï¼è¿ç»­å­¦ä¹ ä¸€å‘¨ï¼ğŸ‰"          |
| streak >= 3           | "å·²ç»è¿ç»­å­¦ä¹  {n} å¤©äº†ï¼Œç»§ç»­ä¿æŒï¼" |
| streak == 0           | "ä»Šå¤©å¼€å§‹æ–°çš„å­¦ä¹ ä¹‹æ—…å§ï¼"          |
| completion_rate >= 80 | "ç‹¬ç«‹å®Œæˆç‡å¾ˆé«˜ï¼Œç»§ç»­ä¿æŒï¼ğŸ’ª"      |
| completion_rate < 50  | "å¤šæ€è€ƒä¸€ä¸‹ï¼Œä½ å¯ä»¥çš„ï¼"            |

---

## 5. å®ç°è®¡åˆ’

### Phase 1: åç«¯å¢å¼º (30min)

- [ ] åˆ›å»º `EnhancedStatsService`
- [ ] å®ç°è¿ç»­å­¦ä¹ å¤©æ•°è®¡ç®—
- [ ] å®ç°é¢˜å‹ç»Ÿè®¡èšåˆ
- [ ] åˆ›å»º `/stats/dashboard` endpoint
- [ ] å•å…ƒæµ‹è¯•

### Phase 2: å‰ç«¯é‡æ„ (30min)

- [ ] åˆ›å»ºæ–°ç»„ä»¶ç»“æ„
- [ ] å®ç°è¿›åº¦æ¡ç»„ä»¶
- [ ] æ·»åŠ é¼“åŠ±æ€§æ–‡æ¡ˆé€»è¾‘
- [ ] å“åº”å¼å¸ƒå±€
- [ ] E2E æµ‹è¯•

### Phase 3: ä¼˜åŒ– (å¯é€‰)

- [ ] æ·»åŠ è¶‹åŠ¿å›¾è¡¨ (chart.js)
- [ ] æ·»åŠ å­¦ä¹ ç›®æ ‡è®¾å®š
- [ ] æ·»åŠ æˆå°±ç³»ç»Ÿ

---

## 6. API Response ç¤ºä¾‹

```json
{
  "total_learning_days": 12,
  "independent_completion_rate": 75.0,
  "sessions_this_week": 8,
  "learning_streak": 3,
  "avg_confusion_count": 1.5,
  "avg_layers_to_complete": 2.8,
  "problem_type_stats": [
    {
      "type": "linear_equation_1var",
      "label": "ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹",
      "total": 20,
      "completed": 17,
      "revealed": 3,
      "completion_rate": 85.0
    },
    {
      "type": "quadratic_equation",
      "label": "ä¸€å…ƒäºŒæ¬¡æ–¹ç¨‹",
      "total": 3,
      "completed": 1,
      "revealed": 2,
      "completion_rate": 33.3
    }
  ],
  "recent_sessions": [
    {
      "session_id": "ses_abc123",
      "problem_text": "3x + 5 = 14",
      "status": "completed",
      "final_layer": "completed",
      "started_at": "2024-01-08T10:30:00Z"
    }
  ],
  "first_session_date": "2024-01-01T08:00:00Z",
  "last_session_date": "2024-01-08T10:30:00Z",
  "encouragement": {
    "streak_message": "å·²ç»è¿ç»­å­¦ä¹  3 å¤©äº†ï¼Œç»§ç»­ä¿æŒï¼",
    "performance_message": "ç‹¬ç«‹å®Œæˆç‡å¾ˆé«˜ï¼Œç»§ç»­ä¿æŒï¼ğŸ’ª"
  }
}
```

---

## 7. éªŒæ”¶æ ‡å‡†

1. âœ… Dashboard æ˜¾ç¤º4ä¸ªæ ¸å¿ƒæŒ‡æ ‡å¡ç‰‡
2. âœ… æ˜¾ç¤ºé¢˜å‹æŒæ¡è¿›åº¦æ¡
3. âœ… æ˜¾ç¤ºæœ€è¿‘5æ¡ç»ƒä¹ è®°å½•
4. âœ… æ˜¾ç¤ºä¸ªæ€§åŒ–é¼“åŠ±æ–‡æ¡ˆ
5. âœ… æ‰€æœ‰æ•°æ®ä»åç«¯APIè·å–
6. âœ… åç«¯æµ‹è¯•è¦†ç›–
7. âœ… E2Eæµ‹è¯•è¦†ç›–
